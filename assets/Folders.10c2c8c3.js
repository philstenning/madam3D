var ne=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var R=(e,r,t)=>r in e?ne(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,k=(e,r)=>{for(var t in r||(r={}))ae.call(r,t)&&R(e,t,r[t]);if(E)for(var t of E(r))ie.call(r,t)&&R(e,t,r[t]);return e},M=(e,r)=>re(e,se(r));import{b as le}from"./index.esm.d8119274.js";import{b as m,j as f,A as D,s as T,r as x,t as oe,F as P,v as $,N as U}from"./vendor.bcd75120.js";import{d as I,F as C,B as ce,a as de,b as ue,u as w,e as _,r as he,f as fe,s as O,t as pe,g as me,h as ge,i as ye,j as Fe,k as ve,l as we,m as N,n as W,o as _e,p as xe}from"./index.96d76a2a.js";async function H(e){const r=Ce(e);if(!e)return r.message="No folder selected",r;const t=await I.folders.where({name:e.name}).toArray();for(const s of t)if(s&&!await s.handle.isSameEntry(e.handle))return r.message="Folder already exists in database",r.result=!1,r;try{const s=await I.folders.add(e);return console.log(`folder added to db: ${s}`),r.result=!0,r.message=s.toString(),r}catch(s){return console.error("Error saving data to Folders table: ",s),r.message="Error saving data to Folders table",r}}function Ce(e,r=!1,t=""){return{result:r,message:t,object:e||null}}function z(e){return{id:e.id,name:e.name,created:e.created.toLocaleString(),updated:e.updated.toLocaleString()}}const Ne=({file:e})=>m("div",{className:"card",children:[e.type===C.STL&&f(ce,{fileUrl:e.imageUrl}),e.type===C.THREE_MF&&f(de,{fileUrl:e.imageUrl}),e.type===C.GCODE&&f(ue,{fileUrl:e.imageUrl}),f(Se,{file:e})]}),Se=({file:e})=>{const r=w(p=>p.selectedFolderItemsReducer.selectedParts.filter(n=>n.id===e.id).length===1),{folderId:t,id:s,rootId:c,name:d}=e,h=_(),a=p=>{p.stopPropagation(),h(r?he(s):fe({id:s,folderId:t,rootId:c}))};return f(D,{children:f(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"card-overlay",onClick:p=>a(p),children:m("div",{className:"overlay-content",children:[f("p",{className:"card-filename",children:d}),f("div",{className:"overlay-checkbox",children:f("input",{type:"checkbox",checked:r,readOnly:!0})})]})})})};async function G(e){let r=await e.queryPermission();return r==="prompt"&&(r=await e.requestPermission()),r==="granted"}var j={exports:{}},Q={exports:{}};(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,s){return t<<s|t>>>32-s},rotr:function(t,s){return t<<32-s|t>>>s},endian:function(t){if(t.constructor==Number)return r.rotl(t,8)&16711935|r.rotl(t,24)&4278255360;for(var s=0;s<t.length;s++)t[s]=r.endian(t[s]);return t},randomBytes:function(t){for(var s=[];t>0;t--)s.push(Math.floor(Math.random()*256));return s},bytesToWords:function(t){for(var s=[],c=0,d=0;c<t.length;c++,d+=8)s[d>>>5]|=t[c]<<24-d%32;return s},wordsToBytes:function(t){for(var s=[],c=0;c<t.length*32;c+=8)s.push(t[c>>>5]>>>24-c%32&255);return s},bytesToHex:function(t){for(var s=[],c=0;c<t.length;c++)s.push((t[c]>>>4).toString(16)),s.push((t[c]&15).toString(16));return s.join("")},hexToBytes:function(t){for(var s=[],c=0;c<t.length;c+=2)s.push(parseInt(t.substr(c,2),16));return s},bytesToBase64:function(t){for(var s=[],c=0;c<t.length;c+=3)for(var d=t[c]<<16|t[c+1]<<8|t[c+2],h=0;h<4;h++)c*8+h*6<=t.length*8?s.push(e.charAt(d>>>6*(3-h)&63)):s.push("=");return s.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var s=[],c=0,d=0;c<t.length;d=++c%4)d!=0&&s.push((e.indexOf(t.charAt(c-1))&Math.pow(2,-2*d+8)-1)<<d*2|e.indexOf(t.charAt(c))>>>6-d*2);return s}};Q.exports=r})();var L={utf8:{stringToBytes:function(e){return L.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(L.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var r=[],t=0;t<e.length;t++)r.push(e.charCodeAt(t)&255);return r},bytesToString:function(e){for(var r=[],t=0;t<e.length;t++)r.push(String.fromCharCode(e[t]));return r.join("")}}},q=L;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var be=function(e){return e!=null&&(V(e)||ke(e)||!!e._isBuffer)};function V(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function ke(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&V(e.slice(0,0))}(function(){var e=Q.exports,r=q.utf8,t=be,s=q.bin,c=function(d,h){d.constructor==String?h&&h.encoding==="binary"?d=s.stringToBytes(d):d=r.stringToBytes(d):t(d)?d=Array.prototype.slice.call(d,0):!Array.isArray(d)&&d.constructor!==Uint8Array&&(d=d.toString());for(var a=e.bytesToWords(d),p=d.length*8,n=1732584193,i=-271733879,o=-1732584194,l=271733878,u=0;u<a.length;u++)a[u]=(a[u]<<8|a[u]>>>24)&16711935|(a[u]<<24|a[u]>>>8)&4278255360;a[p>>>5]|=128<<p%32,a[(p+64>>>9<<4)+14]=p;for(var v=c._ff,g=c._gg,F=c._hh,y=c._ii,u=0;u<a.length;u+=16){var S=n,b=i,ee=o,te=l;n=v(n,i,o,l,a[u+0],7,-680876936),l=v(l,n,i,o,a[u+1],12,-389564586),o=v(o,l,n,i,a[u+2],17,606105819),i=v(i,o,l,n,a[u+3],22,-1044525330),n=v(n,i,o,l,a[u+4],7,-176418897),l=v(l,n,i,o,a[u+5],12,1200080426),o=v(o,l,n,i,a[u+6],17,-1473231341),i=v(i,o,l,n,a[u+7],22,-45705983),n=v(n,i,o,l,a[u+8],7,1770035416),l=v(l,n,i,o,a[u+9],12,-1958414417),o=v(o,l,n,i,a[u+10],17,-42063),i=v(i,o,l,n,a[u+11],22,-1990404162),n=v(n,i,o,l,a[u+12],7,1804603682),l=v(l,n,i,o,a[u+13],12,-40341101),o=v(o,l,n,i,a[u+14],17,-1502002290),i=v(i,o,l,n,a[u+15],22,1236535329),n=g(n,i,o,l,a[u+1],5,-165796510),l=g(l,n,i,o,a[u+6],9,-1069501632),o=g(o,l,n,i,a[u+11],14,643717713),i=g(i,o,l,n,a[u+0],20,-373897302),n=g(n,i,o,l,a[u+5],5,-701558691),l=g(l,n,i,o,a[u+10],9,38016083),o=g(o,l,n,i,a[u+15],14,-660478335),i=g(i,o,l,n,a[u+4],20,-405537848),n=g(n,i,o,l,a[u+9],5,568446438),l=g(l,n,i,o,a[u+14],9,-1019803690),o=g(o,l,n,i,a[u+3],14,-187363961),i=g(i,o,l,n,a[u+8],20,1163531501),n=g(n,i,o,l,a[u+13],5,-1444681467),l=g(l,n,i,o,a[u+2],9,-51403784),o=g(o,l,n,i,a[u+7],14,1735328473),i=g(i,o,l,n,a[u+12],20,-1926607734),n=F(n,i,o,l,a[u+5],4,-378558),l=F(l,n,i,o,a[u+8],11,-2022574463),o=F(o,l,n,i,a[u+11],16,1839030562),i=F(i,o,l,n,a[u+14],23,-35309556),n=F(n,i,o,l,a[u+1],4,-1530992060),l=F(l,n,i,o,a[u+4],11,1272893353),o=F(o,l,n,i,a[u+7],16,-155497632),i=F(i,o,l,n,a[u+10],23,-1094730640),n=F(n,i,o,l,a[u+13],4,681279174),l=F(l,n,i,o,a[u+0],11,-358537222),o=F(o,l,n,i,a[u+3],16,-722521979),i=F(i,o,l,n,a[u+6],23,76029189),n=F(n,i,o,l,a[u+9],4,-640364487),l=F(l,n,i,o,a[u+12],11,-421815835),o=F(o,l,n,i,a[u+15],16,530742520),i=F(i,o,l,n,a[u+2],23,-995338651),n=y(n,i,o,l,a[u+0],6,-198630844),l=y(l,n,i,o,a[u+7],10,1126891415),o=y(o,l,n,i,a[u+14],15,-1416354905),i=y(i,o,l,n,a[u+5],21,-57434055),n=y(n,i,o,l,a[u+12],6,1700485571),l=y(l,n,i,o,a[u+3],10,-1894986606),o=y(o,l,n,i,a[u+10],15,-1051523),i=y(i,o,l,n,a[u+1],21,-2054922799),n=y(n,i,o,l,a[u+8],6,1873313359),l=y(l,n,i,o,a[u+15],10,-30611744),o=y(o,l,n,i,a[u+6],15,-1560198380),i=y(i,o,l,n,a[u+13],21,1309151649),n=y(n,i,o,l,a[u+4],6,-145523070),l=y(l,n,i,o,a[u+11],10,-1120210379),o=y(o,l,n,i,a[u+2],15,718787259),i=y(i,o,l,n,a[u+9],21,-343485551),n=n+S>>>0,i=i+b>>>0,o=o+ee>>>0,l=l+te>>>0}return e.endian([n,i,o,l])};c._ff=function(d,h,a,p,n,i,o){var l=d+(h&a|~h&p)+(n>>>0)+o;return(l<<i|l>>>32-i)+h},c._gg=function(d,h,a,p,n,i,o){var l=d+(h&p|a&~p)+(n>>>0)+o;return(l<<i|l>>>32-i)+h},c._hh=function(d,h,a,p,n,i,o){var l=d+(h^a^p)+(n>>>0)+o;return(l<<i|l>>>32-i)+h},c._ii=function(d,h,a,p,n,i,o){var l=d+(a^(h|~p))+(n>>>0)+o;return(l<<i|l>>>32-i)+h},c._blocksize=16,c._digestsize=16,j.exports=function(d,h){if(d==null)throw new Error("Illegal argument "+d);var a=e.wordsToBytes(c(d,h));return h&&h.asBytes?a:h&&h.asString?s.bytesToString(a):e.bytesToHex(a)}})();var Y=j.exports;async function De(){try{const e=await window.showDirectoryPicker({});if(e.kind==="directory")return A(e)}catch(e){console.error(`Error: ${e}`)}return null}function A(e,r="/",t=!1,s="",c=0){const d=new Date;return{id:Y(e.name+d.toISOString()),handle:e,created:d,updated:d,name:e.name,isRoot:t,filePath:r,rootId:s,parts:c}}async function Te(e){let r=[];if(!e)return r;for await(const t of e.handle.values())if(t.kind==="file"&&(t.name.toLowerCase().endsWith(".stl")||t.name.toLowerCase().endsWith(".3mf")||t.name.toLowerCase().endsWith(".gcode"))){const s=await Pe(e,t);s&&r.push(s)}return r}async function Z(e,r,t=!1,s=""){console.log(`folder: ${r}`);let c=[];const d=[];try{for await(const p of e.values())p.kind==="directory"?d.push(p):p.kind==="file"&&(p.name.toLowerCase().endsWith(".stl")||p.name.toLowerCase().endsWith(".3mf")||p.name.toLowerCase().endsWith(".gcode"))&&c.push(p)}catch(p){console.error(`Error getting folder entries:\r
              ${p}`)}let h=null;const a=c.length;if(a>0||t)if(console.log(`	files: ${c.length}`),t){const p=A(e,r,t,"",a);p.rootId=p.id,h=await H(p),s=p.id}else{const p=A(e,r,t,s,a);h=await H(p)}else console.log(`folder not added ${r}`);for await(const p of d)await Z(p,`${r}/${p.name}`,!1,s);return h}async function Pe(e,r){const t=await e.handle.getFileHandle(r.name),s=await t.getFile(),c=URL.createObjectURL(s),d=Ie(s);return d!==C.NOT_SUPPORTED?Le(s,t,c,e.id,e.rootId,d):null}function Ie(e){switch(e.name.toLowerCase().split(".").pop()){case"stl":return C.STL;case"3mf":return C.THREE_MF;case"gcode":return C.GCODE;default:return C.NOT_SUPPORTED}}function Le(e,r,t,s,c,d){return{id:Y(`${e.name}${s}`),created:new Date(e.lastModified),folderId:s,rootId:c,handle:r,name:e.name,printed:!1,size:e.size,type:d,updated:new Date(e.lastModified),description:"",imageUrl:t,projectId:[s]}}function J(e,r=1,t=0,s=4){let c=t+r>0?t+r:0;const d=Math.ceil(e/s);return c>=d&&(c=d-1),{newCursor:c}}function K(e,r,t){return Math.ceil(e.length/t)===r&&--r,e.slice(r*t,(r+1)*t)}const Ae=({countOfFiles:e,limit:r})=>{const t=w(h=>h.folderReducer.cursor),s=_(),c=Math.ceil(e/r),d=(h,a)=>{h.preventDefault();const{newCursor:p}=J(e,a,t,r);console.log("cursor",t,"newCursor",p),s(O(p))};return m("div",{className:"pagination",children:[f("button",{type:"button",className:"btn pagination__btn",onClick:h=>d(h,-1),disabled:t===0,children:"Previous"}),m("p",{className:"pagination__txt",children:[t+1|0," of ",c]}),f("button",{type:"button",className:"btn pagination__btn",onClick:h=>d(h,1),disabled:t===c-1,children:"Next"})]})};function X(){const{innerHeight:e,innerWidth:r}=window,t=parseFloat(getComputedStyle(document.documentElement).fontSize),s=Math.floor(r-19.6*t),d=Math.floor(e-8*t)>490?2:1;let h={"--model-list-columns":4,"--model-list-rows":d},a=2;return s>950?(a=3*d,h["--model-list-columns"]=3):s>500?(a=2*d,h["--model-list-columns"]=2):s<500&&(a=1*d,h["--model-list-columns"]=1),{style:h,listQuantity:a}}const Be=()=>{const{cursor:e,currentFolder:r}=w(g=>g.folderReducer),t=r==null?void 0:r.id,s=_(),[c,d]=x.exports.useState([]),[h,a]=x.exports.useState([]),[p,n]=x.exports.useState(4),[i,o]=x.exports.useState(),[l,{width:u,height:v}]=oe();return x.exports.useEffect(()=>{const{listQuantity:g,style:F}=X();o(F),n(g);const y=K(c,e,g);a(y)},[e,u,v]),x.exports.useEffect(()=>{const{listQuantity:g}=X();(async()=>{if(t){const F=await I.folders.where({id:t}).first();if(!F)return;const y=await Te(F);if(y){d(y);const{newCursor:S}=J(y.length,0,0,g),b=K(y,S,g);a(b),s(O(0))}else d([])}})()},[t]),m(P,{children:[t&&f(Ae,{countOfFiles:c.length,limit:p}),t&&f("div",{ref:l,style:i,className:"model-list",children:h==null?void 0:h.map(g=>f(Ne,{file:g},$()))})]})};const B=({children:e,type:r="secondary"})=>f("span",{className:`badge ${r}`,children:e}),Ee=()=>{const e=w(d=>d.folderReducer.currentFolder),r=w(d=>d.selectedFolderItemsReducer.selectedParts),t=_();if(typeof e=="undefined")return null;const s=()=>{(e==null?void 0:e.id)&&t(ve())};function c(){return r.filter(d=>d.folderId===(e==null?void 0:e.id)).length}return f(P,{children:m("div",{className:"fd",children:[f("div",{children:f("button",{onClick:s,children:"Delete"})}),m("ul",{className:"fd__list",children:[m("li",{children:["path: ",(e==null?void 0:e.filePath)||(e==null?void 0:e.name)]}),m("li",{children:["added: ",e==null?void 0:e.created]}),m("li",{className:"flex-start",children:["selected:"," ",f(B,{type:c()?"primary":"secondary",children:c()})]})]}),f("button",{role:"button",className:"btn badge",onClick:()=>t(pe()),children:"filters"}),f(Re,{})]})})},Re=()=>{const e=w(s=>s.settingsReducer),r=_();function t(s,c){s.stopPropagation(),r(we(c))}return f(D,{children:e.folder.settingDetailsIsOpen&&m(T.ul,{style:{overflow:"hidden"},initial:{opacity:0,height:0},animate:{opacity:1,height:"fit-content"},exit:{opacity:0,height:0},transition:{type:"tween"},className:"fd__more","data-cy":"folder-details",children:[m("li",{className:"flex flex-column",children:[m("div",{children:[f("label",{className:"pr-0",htmlFor:"all",children:"all files"}),f("input",{onChange:s=>t(s,"allFiles"),type:"radio",id:"all",name:"selected",value:"all",checked:e.partsFilter==="allFiles"})]}),m("div",{children:[f("label",{className:"pr-0",htmlFor:"selected",children:"selected files only"}),f("input",{type:"radio",id:"selected",name:"selected",value:"selected",checked:e.partsFilter==="selectedFiles",onChange:s=>t(s,"selectedFiles")})]}),m("div",{children:[f("label",{className:"pr-0",htmlFor:"unselected",children:"unselected files only"}),f("input",{onChange:s=>t(s,"unSelectedFiles"),type:"radio",id:"unselected",name:"selected",value:"unselected",checked:e.partsFilter==="unSelectedFiles"})]})]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"stl",children:[".stl"," "]}),f("input",{id:"stl",type:"checkbox",checked:e.show.stl,onChange:()=>r(me())})]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"3MF",children:[".3MF"," "]}),f("input",{id:"3MF",type:"checkbox",checked:e.show.threeMF,onChange:()=>r(ge())})," "]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"gcode",children:[".gcode"," "]}),f("input",{id:"gcode",type:"checkbox",checked:e.show.gcode,onChange:()=>r(ye())})," "]}),m("li",{children:[" ",f("label",{className:"pr-0",htmlFor:"search-filters-parts",children:"search filters parts"}),f("input",{id:"search-filters-parts",type:"checkbox",checked:e.folder.searchFiltersParts,onChange:()=>r(Fe())})," "]})]})})},Me=({folder:e})=>{const r=_(),t=w(h=>h.selectedFolderItemsReducer.selectedParts),s=async h=>{if(h.stopPropagation(),await G(e.handle)){const p={created:e.created.toDateString(),id:e.id,name:e.name,updated:e.updated.toDateString(),filePath:e.filePath};r(N(p))}},c=h=>t.filter(a=>a.folderId===h).length,d=h=>`${h.parts} parts`;return f("li",{className:"accordion__child-item",onClick:h=>s(h),children:m(U,{className:`accordion__link  
       
        accordion__child-link`,to:`/folders/${e.id}`,children:[e.name,f("span",{className:"flex-end",children:f(B,{type:c(e.id)>0?"primary":"secondary",children:d(e)})})]})})},$e=({folders:e})=>{const[r,t]=x.exports.useState(e),s=w(n=>n.folderReducer.currentRootFolder),c=w(n=>n.selectedFolderItemsReducer.selectedParts),d=w(n=>n.searchReducer.searchText),h=_();x.exports.useEffect(()=>{e&&t(Ue(e,d))},[d,e]);const a=async n=>{if(n.id===(s==null?void 0:s.id)){h(W(null)),h(N(null));return}if(await G(n.handle)){const o=z(n);h(W(o)),h(N(o))}},p=n=>(s==null?void 0:s.id)===n.rootId;return f("ul",{className:" accordion__group__list",children:r==null?void 0:r.filter(n=>n.isRoot).map(n=>m("li",{className:"accordion__item",onClick:()=>a(n),children:[m(U,{className:"accordion__link ",to:`/folders/${n.id}`,children:[n.name," ",f("span",{className:"flex-end",children:m(B,{type:c.filter(i=>i.rootId===n.rootId).length>0?"primary":"secondary",children:[r.filter(i=>i.rootId===n.rootId).length+(n.parts>0?0:-1)," ","models"]})})]}),f(Oe,{folders:r,isActive:p(n),rootFolder:n})]},n.id))})};function Ue(e,r){const t=e.filter(c=>c.name.includes(r)&&!c.isRoot),s=e.filter(c=>c.isRoot).map(c=>c.name.includes(r)?k({},c):M(k({},c),{parts:0})).filter(c=>c.parts>0||t.filter(d=>d.rootId===c.id).length>0);return[...t,...s]}const Oe=({rootFolder:e,folders:r,isActive:t})=>f(D,{children:t&&f(T.ul,{style:{overflow:"hidden",display:"flex",gap:"0.5rem",flexDirection:"column"},initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{type:"tween"},className:"accordion__child-list",children:r.filter(s=>s.rootId===e.rootId).map(s=>{if(s.parts)return f(Me,{folder:s},$())})})});const We=({children:e,title:r,show:t})=>f(P,{children:t&&f("div",{className:"dialog",children:m("div",{className:"dialog__container",children:[f("h4",{className:"dialog__title",children:r}),e]})})});function He(){var s;const e=w(c=>c.folderReducer),r=_(),t=()=>{var c,d;((c=e.currentFolder)==null?void 0:c.id)&&r(xe((d=e.currentFolder)==null?void 0:d.id))};return m(We,{title:"Delete Folder",show:e.showDialog,children:[f("p",{children:"Are you sure you want to delete the folder:"}),f("p",{children:(s=e.currentFolder)==null?void 0:s.name}),m("div",{className:"dialog__buttons",children:[f("button",{className:"btn dialog__btn",onClick:()=>r(_e()),children:"no"}),f("button",{className:"btn dialog__btn",onClick:t,children:"Yes"})]})]})}const qe=({allFolders:e})=>{const r=_();async function t(s){s.preventDefault();const c=await De();if(c){const d=await Z(c.handle,c.name,!0);d&&r(N(z(d.object)))}}return m("div",{className:"page",children:[f(He,{}),f("header",{className:"aside__header",children:m("button",{className:"btn",onClick:s=>t(s),children:[f(le,{className:"font-size--l"}),f("span",{className:"font-size--m",children:" Add Folder"})]})}),m("div",{className:"aside",children:[f($e,{folders:e}),f(Ee,{})]}),f(Be,{})]})};export{qe as default};
