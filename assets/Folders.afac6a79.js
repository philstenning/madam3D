var ne=Object.defineProperty,re=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var R=(e,s,t)=>s in e?ne(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,k=(e,s)=>{for(var t in s||(s={}))se.call(s,t)&&R(e,t,s[t]);if(B)for(var t of B(s))ie.call(s,t)&&R(e,t,s[t]);return e},$=(e,s)=>re(e,ae(s));import{b as le}from"./index.esm.61f6eecf.js";import{b as m,j as f,r as _,A as D,s as P,t as oe,F as T,v as M,N as U}from"./vendor.3aa183e4.js";import{d as L,F as x,B as ce,a as de,b as ue,u as w,e as C,r as he,f as fe,s as O,t as pe,g as me,h as ge,i as ye,j as Fe,k as ve,l as we,m as N,n as W,o as _e,p as xe}from"./index.4acaff53.js";async function H(e){const s=Ce(e);if(!e)return s.message="No folder selected",s;const t=await L.folders.where({name:e.name}).toArray();for(const r of t)if(r&&!await r.handle.isSameEntry(e.handle))return s.message="Folder already exists in database",s.result=!1,s;try{const r=await L.folders.add(e);return console.log(`folder added to db: ${r}`),s.result=!0,s.message=r.toString(),s}catch(r){return console.error("Error saving data to Folders table: ",r),s.message="Error saving data to Folders table",s}}function Ce(e,s=!1,t=""){return{result:s,message:t,object:e||null}}function z(e){return{id:e.id,name:e.name,created:e.created.toLocaleString(),updated:e.updated.toLocaleString()}}const Ne=({file:e})=>m("div",{className:"card",children:[e.type===x.STL&&f(ce,{fileUrl:e.imageUrl}),e.type===x.THREE_MF&&f(de,{fileUrl:e.imageUrl}),e.type===x.GCODE&&f(ue,{fileUrl:e.imageUrl}),f(Se,{file:e})]}),Se=({file:e})=>{const[s,t]=_.exports.useState(""),r=w(a=>a.selectedFolderItemsReducer.selectedParts.filter(l=>l.id===e.id).length===1),{folderId:c,id:d,rootId:h,name:i}=e,p=C(),n=a=>{a.stopPropagation(),p(r?he(d):fe({id:d,folderId:c,rootId:h}))};return _.exports.useEffect(()=>{(async()=>{const l=await e.handle.getFile(),o=URL.createObjectURL(l);t(o)})()},[e]),f(D,{children:m(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"card-overlay",children:[m("label",{htmlFor:`model-selected-ck-${e.id}`,className:"card-overlay__filename",children:[f("input",{id:`model-selected-ck-${e.id}`,type:"checkbox",checked:r,readOnly:!0,onClick:a=>n(a)}),i]}),f("a",{href:s,download:e.name,className:"btn card-overlay__open-in-native-app",children:e.type===x.GCODE?"Print":"Slice"})]})})};async function G(e){let s=await e.queryPermission();return s==="prompt"&&(s=await e.requestPermission()),s==="granted"}var j={exports:{}},Q={exports:{}};(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s={rotl:function(t,r){return t<<r|t>>>32-r},rotr:function(t,r){return t<<32-r|t>>>r},endian:function(t){if(t.constructor==Number)return s.rotl(t,8)&16711935|s.rotl(t,24)&4278255360;for(var r=0;r<t.length;r++)t[r]=s.endian(t[r]);return t},randomBytes:function(t){for(var r=[];t>0;t--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(t){for(var r=[],c=0,d=0;c<t.length;c++,d+=8)r[d>>>5]|=t[c]<<24-d%32;return r},wordsToBytes:function(t){for(var r=[],c=0;c<t.length*32;c+=8)r.push(t[c>>>5]>>>24-c%32&255);return r},bytesToHex:function(t){for(var r=[],c=0;c<t.length;c++)r.push((t[c]>>>4).toString(16)),r.push((t[c]&15).toString(16));return r.join("")},hexToBytes:function(t){for(var r=[],c=0;c<t.length;c+=2)r.push(parseInt(t.substr(c,2),16));return r},bytesToBase64:function(t){for(var r=[],c=0;c<t.length;c+=3)for(var d=t[c]<<16|t[c+1]<<8|t[c+2],h=0;h<4;h++)c*8+h*6<=t.length*8?r.push(e.charAt(d>>>6*(3-h)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],c=0,d=0;c<t.length;d=++c%4)d!=0&&r.push((e.indexOf(t.charAt(c-1))&Math.pow(2,-2*d+8)-1)<<d*2|e.indexOf(t.charAt(c))>>>6-d*2);return r}};Q.exports=s})();var E={utf8:{stringToBytes:function(e){return E.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(E.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var s=[],t=0;t<e.length;t++)s.push(e.charCodeAt(t)&255);return s},bytesToString:function(e){for(var s=[],t=0;t<e.length;t++)s.push(String.fromCharCode(e[t]));return s.join("")}}},q=E;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var be=function(e){return e!=null&&(V(e)||ke(e)||!!e._isBuffer)};function V(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function ke(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&V(e.slice(0,0))}(function(){var e=Q.exports,s=q.utf8,t=be,r=q.bin,c=function(d,h){d.constructor==String?h&&h.encoding==="binary"?d=r.stringToBytes(d):d=s.stringToBytes(d):t(d)?d=Array.prototype.slice.call(d,0):!Array.isArray(d)&&d.constructor!==Uint8Array&&(d=d.toString());for(var i=e.bytesToWords(d),p=d.length*8,n=1732584193,a=-271733879,l=-1732584194,o=271733878,u=0;u<i.length;u++)i[u]=(i[u]<<8|i[u]>>>24)&16711935|(i[u]<<24|i[u]>>>8)&4278255360;i[p>>>5]|=128<<p%32,i[(p+64>>>9<<4)+14]=p;for(var v=c._ff,g=c._gg,F=c._hh,y=c._ii,u=0;u<i.length;u+=16){var S=n,b=a,ee=l,te=o;n=v(n,a,l,o,i[u+0],7,-680876936),o=v(o,n,a,l,i[u+1],12,-389564586),l=v(l,o,n,a,i[u+2],17,606105819),a=v(a,l,o,n,i[u+3],22,-1044525330),n=v(n,a,l,o,i[u+4],7,-176418897),o=v(o,n,a,l,i[u+5],12,1200080426),l=v(l,o,n,a,i[u+6],17,-1473231341),a=v(a,l,o,n,i[u+7],22,-45705983),n=v(n,a,l,o,i[u+8],7,1770035416),o=v(o,n,a,l,i[u+9],12,-1958414417),l=v(l,o,n,a,i[u+10],17,-42063),a=v(a,l,o,n,i[u+11],22,-1990404162),n=v(n,a,l,o,i[u+12],7,1804603682),o=v(o,n,a,l,i[u+13],12,-40341101),l=v(l,o,n,a,i[u+14],17,-1502002290),a=v(a,l,o,n,i[u+15],22,1236535329),n=g(n,a,l,o,i[u+1],5,-165796510),o=g(o,n,a,l,i[u+6],9,-1069501632),l=g(l,o,n,a,i[u+11],14,643717713),a=g(a,l,o,n,i[u+0],20,-373897302),n=g(n,a,l,o,i[u+5],5,-701558691),o=g(o,n,a,l,i[u+10],9,38016083),l=g(l,o,n,a,i[u+15],14,-660478335),a=g(a,l,o,n,i[u+4],20,-405537848),n=g(n,a,l,o,i[u+9],5,568446438),o=g(o,n,a,l,i[u+14],9,-1019803690),l=g(l,o,n,a,i[u+3],14,-187363961),a=g(a,l,o,n,i[u+8],20,1163531501),n=g(n,a,l,o,i[u+13],5,-1444681467),o=g(o,n,a,l,i[u+2],9,-51403784),l=g(l,o,n,a,i[u+7],14,1735328473),a=g(a,l,o,n,i[u+12],20,-1926607734),n=F(n,a,l,o,i[u+5],4,-378558),o=F(o,n,a,l,i[u+8],11,-2022574463),l=F(l,o,n,a,i[u+11],16,1839030562),a=F(a,l,o,n,i[u+14],23,-35309556),n=F(n,a,l,o,i[u+1],4,-1530992060),o=F(o,n,a,l,i[u+4],11,1272893353),l=F(l,o,n,a,i[u+7],16,-155497632),a=F(a,l,o,n,i[u+10],23,-1094730640),n=F(n,a,l,o,i[u+13],4,681279174),o=F(o,n,a,l,i[u+0],11,-358537222),l=F(l,o,n,a,i[u+3],16,-722521979),a=F(a,l,o,n,i[u+6],23,76029189),n=F(n,a,l,o,i[u+9],4,-640364487),o=F(o,n,a,l,i[u+12],11,-421815835),l=F(l,o,n,a,i[u+15],16,530742520),a=F(a,l,o,n,i[u+2],23,-995338651),n=y(n,a,l,o,i[u+0],6,-198630844),o=y(o,n,a,l,i[u+7],10,1126891415),l=y(l,o,n,a,i[u+14],15,-1416354905),a=y(a,l,o,n,i[u+5],21,-57434055),n=y(n,a,l,o,i[u+12],6,1700485571),o=y(o,n,a,l,i[u+3],10,-1894986606),l=y(l,o,n,a,i[u+10],15,-1051523),a=y(a,l,o,n,i[u+1],21,-2054922799),n=y(n,a,l,o,i[u+8],6,1873313359),o=y(o,n,a,l,i[u+15],10,-30611744),l=y(l,o,n,a,i[u+6],15,-1560198380),a=y(a,l,o,n,i[u+13],21,1309151649),n=y(n,a,l,o,i[u+4],6,-145523070),o=y(o,n,a,l,i[u+11],10,-1120210379),l=y(l,o,n,a,i[u+2],15,718787259),a=y(a,l,o,n,i[u+9],21,-343485551),n=n+S>>>0,a=a+b>>>0,l=l+ee>>>0,o=o+te>>>0}return e.endian([n,a,l,o])};c._ff=function(d,h,i,p,n,a,l){var o=d+(h&i|~h&p)+(n>>>0)+l;return(o<<a|o>>>32-a)+h},c._gg=function(d,h,i,p,n,a,l){var o=d+(h&p|i&~p)+(n>>>0)+l;return(o<<a|o>>>32-a)+h},c._hh=function(d,h,i,p,n,a,l){var o=d+(h^i^p)+(n>>>0)+l;return(o<<a|o>>>32-a)+h},c._ii=function(d,h,i,p,n,a,l){var o=d+(i^(h|~p))+(n>>>0)+l;return(o<<a|o>>>32-a)+h},c._blocksize=16,c._digestsize=16,j.exports=function(d,h){if(d==null)throw new Error("Illegal argument "+d);var i=e.wordsToBytes(c(d,h));return h&&h.asBytes?i:h&&h.asString?r.bytesToString(i):e.bytesToHex(i)}})();var Y=j.exports;async function De(){try{const e=await window.showDirectoryPicker({});if(e.kind==="directory")return I(e)}catch(e){console.error(`Error: ${e}`)}return null}function I(e,s="/",t=!1,r="",c=0){const d=new Date;return{id:Y(e.name+d.toISOString()),handle:e,created:d,updated:d,name:e.name,isRoot:t,filePath:s,rootId:r,parts:c}}async function Pe(e){let s=[];if(!e)return s;for await(const t of e.handle.values())if(t.kind==="file"&&(t.name.toLowerCase().endsWith(".stl")||t.name.toLowerCase().endsWith(".3mf")||t.name.toLowerCase().endsWith(".gcode"))){const r=await Te(e,t);r&&s.push(r)}return s}async function Z(e,s,t=!1,r=""){console.log(`folder: ${s}`);let c=[];const d=[];try{for await(const p of e.values())p.kind==="directory"?d.push(p):p.kind==="file"&&(p.name.toLowerCase().endsWith(".stl")||p.name.toLowerCase().endsWith(".3mf")||p.name.toLowerCase().endsWith(".gcode"))&&c.push(p)}catch(p){console.error(`Error getting folder entries:\r
              ${p}`)}let h=null;const i=c.length;if(i>0||t)if(console.log(`	files: ${c.length}`),t){const p=I(e,s,t,"",i);p.rootId=p.id,h=await H(p),r=p.id}else{const p=I(e,s,t,r,i);h=await H(p)}else console.log(`folder not added ${s}`);for await(const p of d)await Z(p,`${s}/${p.name}`,!1,r);return h}async function Te(e,s){const t=await e.handle.getFileHandle(s.name),r=await t.getFile(),c=URL.createObjectURL(r),d=Le(r);return d!==x.NOT_SUPPORTED?Ee(r,t,c,e.id,e.rootId,d):null}function Le(e){switch(e.name.toLowerCase().split(".").pop()){case"stl":return x.STL;case"3mf":return x.THREE_MF;case"gcode":return x.GCODE;default:return x.NOT_SUPPORTED}}function Ee(e,s,t,r,c,d){return{id:Y(`${e.name}${r}`),created:new Date(e.lastModified),folderId:r,rootId:c,handle:s,name:e.name,printed:!1,size:e.size,type:d,updated:new Date(e.lastModified),description:"",imageUrl:t,projectId:[r]}}function J(e,s=1,t=0,r=4){let c=t+s>0?t+s:0;const d=Math.ceil(e/r);return c>=d&&(c=d-1),{newCursor:c}}function K(e,s,t){return Math.ceil(e.length/t)===s&&--s,e.slice(s*t,(s+1)*t)}const Ie=({countOfFiles:e,limit:s})=>{const t=w(h=>h.folderReducer.cursor),r=C(),c=Math.ceil(e/s),d=(h,i)=>{h.preventDefault();const{newCursor:p}=J(e,i,t,s);console.log("cursor",t,"newCursor",p),r(O(p))};return m("div",{className:"pagination",children:[f("button",{type:"button",className:"btn pagination__btn",onClick:h=>d(h,-1),disabled:t===0,children:"Previous"}),m("p",{className:"pagination__txt",children:[t+1|0," of ",c]}),f("button",{type:"button",className:"btn pagination__btn",onClick:h=>d(h,1),disabled:t===c-1,children:"Next"})]})};function X(){const{innerHeight:e,innerWidth:s}=window,t=parseFloat(getComputedStyle(document.documentElement).fontSize),r=Math.floor(s-19.6*t),d=Math.floor(e-8*t)>490?2:1;let h={"--model-list-columns":4,"--model-list-rows":d},i=2;return r>950?(i=3*d,h["--model-list-columns"]=3):r>500?(i=2*d,h["--model-list-columns"]=2):r<500&&(i=1*d,h["--model-list-columns"]=1),{style:h,listQuantity:i}}const Ae=()=>{const{cursor:e,currentFolder:s}=w(g=>g.folderReducer),t=s==null?void 0:s.id,r=C(),[c,d]=_.exports.useState([]),[h,i]=_.exports.useState([]),[p,n]=_.exports.useState(4),[a,l]=_.exports.useState(),[o,{width:u,height:v}]=oe();return _.exports.useEffect(()=>{const{listQuantity:g,style:F}=X();l(F),n(g);const y=K(c,e,g);i(y)},[e,u,v]),_.exports.useEffect(()=>{const{listQuantity:g}=X();(async()=>{if(t){const F=await L.folders.where({id:t}).first();if(!F)return;const y=await Pe(F);if(y){d(y);const{newCursor:S}=J(y.length,0,0,g),b=K(y,S,g);i(b),r(O(0))}else d([])}})()},[t]),m(T,{children:[t&&f(Ie,{countOfFiles:c.length,limit:p}),t&&f("div",{ref:o,style:a,className:"model-list",children:h==null?void 0:h.map(g=>f(Ne,{file:g},M()))})]})};const A=({children:e,type:s="secondary"})=>f("span",{className:`badge ${s}`,children:e}),Be=()=>{const e=w(d=>d.folderReducer.currentFolder),s=w(d=>d.selectedFolderItemsReducer.selectedParts),t=C();if(typeof e=="undefined")return null;const r=()=>{(e==null?void 0:e.id)&&t(ve())};function c(){return s.filter(d=>d.folderId===(e==null?void 0:e.id)).length}return f(T,{children:m("div",{className:"fd",children:[f("div",{children:f("button",{onClick:r,children:"Delete"})}),m("ul",{className:"fd__list",children:[m("li",{children:["path: ",(e==null?void 0:e.filePath)||(e==null?void 0:e.name)]}),m("li",{children:["added: ",e==null?void 0:e.created]}),m("li",{className:"flex-start",children:["selected:"," ",f(A,{type:c()?"primary":"secondary",children:c()})]})]}),f("button",{role:"button",className:"btn badge",onClick:()=>t(pe()),children:"filters"}),f(Re,{})]})})},Re=()=>{const e=w(r=>r.settingsReducer),s=C();function t(r,c){r.stopPropagation(),s(we(c))}return f(D,{children:e.folder.settingDetailsIsOpen&&m(P.ul,{style:{overflow:"hidden"},initial:{opacity:0,height:0},animate:{opacity:1,height:"fit-content"},exit:{opacity:0,height:0},transition:{type:"tween"},className:"fd__more","data-cy":"folder-details",children:[m("li",{className:"flex flex-column",children:[m("div",{children:[f("label",{className:"pr-0",htmlFor:"all",children:"all files"}),f("input",{onChange:r=>t(r,"allFiles"),type:"radio",id:"all",name:"selected",value:"all",checked:e.partsFilter==="allFiles"})]}),m("div",{children:[f("label",{className:"pr-0",htmlFor:"selected",children:"selected files only"}),f("input",{type:"radio",id:"selected",name:"selected",value:"selected",checked:e.partsFilter==="selectedFiles",onChange:r=>t(r,"selectedFiles")})]}),m("div",{children:[f("label",{className:"pr-0",htmlFor:"unselected",children:"unselected files only"}),f("input",{onChange:r=>t(r,"unSelectedFiles"),type:"radio",id:"unselected",name:"selected",value:"unselected",checked:e.partsFilter==="unSelectedFiles"})]})]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"stl",children:[".stl"," "]}),f("input",{id:"stl",type:"checkbox",checked:e.show.stl,onChange:()=>s(me())})]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"3MF",children:[".3MF"," "]}),f("input",{id:"3MF",type:"checkbox",checked:e.show.threeMF,onChange:()=>s(ge())})," "]}),m("li",{children:[" ",m("label",{className:"pr-0",htmlFor:"gcode",children:[".gcode"," "]}),f("input",{id:"gcode",type:"checkbox",checked:e.show.gcode,onChange:()=>s(ye())})," "]}),m("li",{children:[" ",f("label",{className:"pr-0",htmlFor:"search-filters-parts",children:"search filters parts"}),f("input",{id:"search-filters-parts",type:"checkbox",checked:e.folder.searchFiltersParts,onChange:()=>s(Fe())})," "]})]})})},$e=({folder:e})=>{const s=C(),t=w(h=>h.selectedFolderItemsReducer.selectedParts),r=async h=>{if(h.stopPropagation(),await G(e.handle)){const p={created:e.created.toDateString(),id:e.id,name:e.name,updated:e.updated.toDateString(),filePath:e.filePath};s(N(p))}},c=h=>t.filter(i=>i.folderId===h).length,d=h=>`${h.parts} parts`;return f("li",{className:"accordion__child-item",onClick:h=>r(h),children:m(U,{className:`accordion__link  
       
        accordion__child-link`,to:`/folders/${e.id}`,children:[e.name,f("span",{className:"flex-end",children:f(A,{type:c(e.id)>0?"primary":"secondary",children:d(e)})})]})})},Me=({folders:e})=>{const[s,t]=_.exports.useState(e),r=w(n=>n.folderReducer.currentRootFolder),c=w(n=>n.selectedFolderItemsReducer.selectedParts),d=w(n=>n.searchReducer.searchText),h=C();_.exports.useEffect(()=>{e&&t(Ue(e,d))},[d,e]);const i=async n=>{if(n.id===(r==null?void 0:r.id)){h(W(null)),h(N(null));return}if(await G(n.handle)){const l=z(n);h(W(l)),h(N(l))}},p=n=>(r==null?void 0:r.id)===n.rootId;return f("ul",{className:" accordion__group__list",children:s==null?void 0:s.filter(n=>n.isRoot).map(n=>m("li",{className:"accordion__item",onClick:()=>i(n),children:[m(U,{className:"accordion__link ",to:`/folders/${n.id}`,children:[n.name," ",f("span",{className:"flex-end",children:m(A,{type:c.filter(a=>a.rootId===n.rootId).length>0?"primary":"secondary",children:[s.filter(a=>a.rootId===n.rootId).length+(n.parts>0?0:-1)," ","models"]})})]}),f(Oe,{folders:s,isActive:p(n),rootFolder:n})]},n.id))})};function Ue(e,s){const t=e.filter(c=>c.name.includes(s)&&!c.isRoot),r=e.filter(c=>c.isRoot).map(c=>c.name.includes(s)?k({},c):$(k({},c),{parts:0})).filter(c=>c.parts>0||t.filter(d=>d.rootId===c.id).length>0);return[...t,...r]}const Oe=({rootFolder:e,folders:s,isActive:t})=>f(D,{children:t&&f(P.ul,{style:{overflow:"hidden",display:"flex",gap:"0.5rem",flexDirection:"column"},initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{type:"tween"},className:"accordion__child-list",children:s.filter(r=>r.rootId===e.rootId).map(r=>{if(r.parts)return f($e,{folder:r},M())})})});const We=({children:e,title:s,show:t})=>f(T,{children:t&&f("div",{className:"dialog",children:m("div",{className:"dialog__container",children:[f("h4",{className:"dialog__title",children:s}),e]})})});function He(){var r;const e=w(c=>c.folderReducer),s=C(),t=()=>{var c,d;((c=e.currentFolder)==null?void 0:c.id)&&s(xe((d=e.currentFolder)==null?void 0:d.id))};return m(We,{title:"Delete Folder",show:e.showDialog,children:[f("p",{children:"Are you sure you want to delete the folder:"}),f("p",{children:(r=e.currentFolder)==null?void 0:r.name}),m("div",{className:"dialog__buttons",children:[f("button",{className:"btn dialog__btn",onClick:()=>s(_e()),children:"no"}),f("button",{className:"btn dialog__btn",onClick:t,children:"Yes"})]})]})}const qe=({allFolders:e})=>{const s=C();async function t(r){r.preventDefault();const c=await De();if(c){const d=await Z(c.handle,c.name,!0);d&&s(N(z(d.object)))}}return m("div",{className:"page",children:[f(He,{}),f("header",{className:"aside__header",children:m("button",{className:"btn",onClick:r=>t(r),children:[f(le,{className:"font-size--l"}),f("span",{className:"font-size--m",children:" Add Folder"})]})}),m("div",{className:"aside",children:[f(Me,{folders:e}),f(Be,{})]}),f(Ae,{})]})};export{qe as default};
